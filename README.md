# Telegram-бот для автоматизации протоколирования встреч на Яндекс.Диске

Бот для записи протоколов встреч и сохранения всех материалов в одном месте на Яндекс.Диске.

## Основные функции

- Создание новых встреч в выбранных папках Яндекс.Диска
- Навигация по структуре папок Яндекс.Диска с возможностью создания новых папок
- Запись текстовых сообщений в протокол встречи с временными метками
- Загрузка и сохранение документов, фотографий и голосовых сообщений
- Распознавание речи в голосовых сообщениях и добавление их в протокол
- Административные функции для управления доступом пользователей и разрешенными папками

## Команды

- `/start` - Начать работу с ботом
- `/new` - Создать новую встречу (запускает выбор папки)
- `/current` - Просмотреть информацию о текущей встрече
- `/end` - Завершить текущую встречу и сохранить протокол
- `/cancel` - Отменить текущее действие
- `/help` - Получить справку о командах
- `/admin` - Меню администратора (доступно только администраторам)

## Требования для установки

- Python 3.8 или выше
- API токен для бота Telegram
- OAuth-токен Яндекс.Диска

## Чек-лист для тестирования

### 1. Аутентификация и доступ
- [ ] Проверка доступа авторизованных пользователей
- [ ] Проверка блокировки неавторизованных пользователей
- [ ] Проверка прав администратора

### 2. Навигация по папкам
- [ ] Отображение списка разрешенных корневых папок
- [ ] Навигация по вложенным папкам
- [ ] Переход на уровень выше
- [ ] Создание новой папки
- [ ] Выбор пустой папки
- [ ] Навигация по длинному списку папок

### 3. Управление встречами
- [ ] Создание новой встречи с выбором папки
- [ ] Просмотр информации о текущей встрече
- [ ] Отправка текстовых сообщений в протокол
- [ ] Завершение встречи и сохранение протокола
- [ ] Попытка создания второй встречи до завершения текущей

### 4. Работа с файлами
- [ ] Загрузка документов различных форматов
- [ ] Загрузка и сохранение фотографий
- [ ] Запись и распознавание голосовых сообщений
- [ ] Загрузка больших файлов (проверка ограничений)
- [ ] Одновременная загрузка нескольких файлов

### 5. Административные функции
- [ ] Просмотр списка разрешенных пользователей
- [ ] Добавление нового пользователя
- [ ] Удаление пользователя
- [ ] Просмотр списка разрешенных папок
- [ ] Добавление новой разрешенной папки
- [ ] Удаление папки из списка разрешенных
- [ ] Перезагрузка кэша папок и списков

### 6. Обработка ошибок
- [ ] Поведение при потере соединения с Яндекс.Диском
- [ ] Обработка недопустимых символов в именах папок
- [ ] Отказоустойчивость при нескольких пользователях
- [ ] Восстановление после перезапуска

## Установка

1. Клонировать репозиторий:
```
git clone https://github.com/yourusername/ITD_Meeting_bot_lite.git
cd ITD_Meeting_bot_lite
```

2. Создать виртуальное окружение и установить зависимости:
```
python -m venv venv
source venv/bin/activate  # для Linux/MacOS
venv\Scripts\activate     # для Windows
pip install -r requirements.txt
```

3. Настроить конфигурацию:
   - Создать файл `.env` в корневой директории и добавить:
   ```
   TELEGRAM_TOKEN=your_telegram_bot_token
   YANDEX_DISK_TOKEN=your_yandex_disk_token
   ```

4. Настроить список разрешенных пользователей и папок:
   - Отредактируйте файлы `data/allowed_users.json` и `data/allowed_folders.json`

5. Запустить бота:
```
python main.py
```

## Основные команды

- `/start` - Начать работу с ботом
- `/help` - Получить справку по командам
- `/new` - Создать новую встречу и выбрать папку для сохранения
- `/current` - Просмотреть информацию о текущей встрече
- `/end` - Завершить текущую встречу
- `/admin` - Доступ к административным функциям (только для администраторов)

## Административные функции

- Просмотр списка разрешенных пользователей
- Добавление/удаление пользователей
- Просмотр списка разрешенных папок
- Добавление/удаление папок
- Перезагрузка списков пользователей и папок

## Чек-лист тестирования

### 1. Аутентификация и доступ

#### 1.1. Проверка разрешенных пользователей
- **Предусловия:** Настроен список разрешенных пользователей в `allowed_users.json`
- **Шаги тестирования:**
  1. Пользователь из списка разрешенных отправляет команду `/start`
  2. Пользователь, не входящий в список разрешенных, отправляет команду `/start`
- **Ожидаемый результат:**
  - Пользователю из списка разрешенных отображается приветственное сообщение
  - Пользователь, не входящий в список, получает сообщение об отказе в доступе
- **Сценарии ошибок:**
  - Файл `allowed_users.json` отсутствует или поврежден
  - Пользователю из списка отказано в доступе
  - Пользователь без прав получил доступ

#### 1.2. Проверка административных прав
- **Предусловия:** Настроен список администраторов в конфигурации
- **Шаги тестирования:**
  1. Пользователь из списка администраторов отправляет команду `/admin`
  2. Обычный пользователь отправляет команду `/admin`
- **Ожидаемый результат:**
  - Администратор получает доступ к административному меню
  - Обычный пользователь получает сообщение об отказе
- **Сценарии ошибок:**
  - Настройки администраторов не загружаются
  - Административное меню не отображается для администратора
  - Обычный пользователь получает доступ к административным функциям

### 2. Навигация по папкам

#### 2.1. Отображение доступных папок
- **Предусловия:** Настроены разрешенные папки, бот подключен к Яндекс.Диску
- **Шаги тестирования:**
  1. Отправить команду `/new`
  2. Убедиться, что отображаются только разрешенные папки
- **Ожидаемый результат:**
  - Отображается список разрешенных папок с кнопками навигации
- **Сценарии ошибок:**
  - Папки не загружаются
  - Отображаются папки, не включенные в список разрешенных
  - Кнопки навигации не работают

#### 2.2. Навигация внутри вложенных папок
- **Предусловия:** Существуют папки с вложенной структурой на Яндекс.Диске
- **Шаги тестирования:**
  1. Отправить команду `/new`
  2. Выбрать папку для перехода внутрь
  3. Перейти на несколько уровней вглубь
  4. Использовать кнопку "Вверх" для возврата
- **Ожидаемый результат:**
  - Корректная навигация между уровнями папок
  - Кнопка "Вверх" работает правильно
- **Сценарии ошибок:**
  - Невозможно перейти в подпапку
  - Кнопка "Вверх" не возвращает на уровень выше
  - Зацикливание при переходе вверх

#### 2.3. Создание новой папки
- **Предусловия:** Пользователь находится в режиме выбора папки
- **Шаги тестирования:**
  1. Нажать кнопку "Новая папка"
  2. Ввести имя новой папки
- **Ожидаемый результат:**
  - Папка успешно создается на Яндекс.Диске
  - Отображается обновленный список папок с новой папкой
- **Сценарии ошибок:**
  - Папка не создается
  - Папка создается с неверным именем
  - Ошибка при создании папки с некорректными символами в имени

### 3. Управление сессиями встреч

#### 3.1. Создание новой встречи
- **Предусловия:** Пользователь аутентифицирован, нет активной сессии
- **Шаги тестирования:**
  1. Отправить команду `/new`
  2. Выбрать папку
  3. Нажать "Выбрать эту папку"
- **Ожидаемый результат:**
  - Создается сессия встречи
  - Создается файл протокола на Яндекс.Диске
  - Пользователь получает подтверждение о начале встречи
- **Сценарии ошибок:**
  - Сессия не создается
  - Файл протокола не создается
  - Ошибка при создании в папке без прав записи

#### 3.2. Просмотр информации о текущей встрече
- **Предусловия:** Есть активная сессия встречи
- **Шаги тестирования:**
  1. Отправить команду `/current`
- **Ожидаемый результат:**
  - Отображается информация о текущей встрече (папка, время начала, продолжительность)
- **Сценарии ошибок:**
  - Информация не отображается
  - Отображается неполная или некорректная информация
  - Команда не работает при отсутствии активной сессии

#### 3.3. Завершение встречи
- **Предусловия:** Есть активная сессия встречи
- **Шаги тестирования:**
  1. Отправить команду `/end`
- **Ожидаемый результат:**
  - Сессия завершается
  - В протокол добавляется информация о завершении
  - Пользователь получает сводку о встрече
- **Сценарии ошибок:**
  - Сессия не завершается
  - Информация о завершении не добавляется в протокол
  - Ошибка при отображении сводки

### 4. Работа с файлами и сообщениями

#### 4.1. Обработка текстовых сообщений
- **Предусловия:** Есть активная сессия встречи
- **Шаги тестирования:**
  1. Отправить текстовое сообщение
- **Ожидаемый результат:**
  - Сообщение добавляется в протокол
  - Пользователь получает подтверждение
- **Сценарии ошибок:**
  - Сообщение не добавляется в протокол
  - Ошибка при сохранении специальных символов
  - Отсутствие подтверждения о сохранении

#### 4.2. Загрузка документов
- **Предусловия:** Есть активная сессия встречи
- **Шаги тестирования:**
  1. Отправить документ (PDF, DOCX, и т.д.)
- **Ожидаемый результат:**
  - Документ загружается в папку встречи на Яндекс.Диске
  - В протокол добавляется запись о загрузке
  - Пользователь получает подтверждение
- **Сценарии ошибок:**
  - Документ не загружается
  - В протокол не добавляется запись
  - Ошибка при загрузке документа большого размера

#### 4.3. Загрузка фотографий
- **Предусловия:** Есть активная сессия встречи
- **Шаги тестирования:**
  1. Отправить фотографию
- **Ожидаемый результат:**
  - Фото загружается в папку встречи на Яндекс.Диске
  - В протокол добавляется запись о загрузке
  - Пользователь получает подтверждение
- **Сценарии ошибок:**
  - Фото не загружается
  - В протокол не добавляется запись
  - Ошибка при загрузке фото с большим разрешением

#### 4.4. Обработка голосовых сообщений
- **Предусловия:** Есть активная сессия встречи, настроено распознавание речи
- **Шаги тестирования:**
  1. Отправить голосовое сообщение
- **Ожидаемый результат:**
  - Голосовое сообщение сохраняется на Яндекс.Диске
  - Текст распознается и добавляется в протокол
  - Пользователь получает распознанный текст
- **Сценарии ошибок:**
  - Голосовое сообщение не сохраняется
  - Ошибка распознавания речи
  - Распознанный текст не добавляется в протокол

### 5. Административные функции

#### 5.1. Управление пользователями
- **Предусловия:** Пользователь с правами администратора
- **Шаги тестирования:**
  1. Отправить команду `/admin`
  2. Выбрать "Список пользователей"
  3. Добавить нового пользователя
  4. Удалить существующего пользователя
- **Ожидаемый результат:**
  - Отображается актуальный список пользователей
  - Новый пользователь успешно добавляется
  - Пользователь успешно удаляется
- **Сценарии ошибок:**
  - Список пользователей не отображается
  - Ошибка при добавлении/удалении пользователя
  - Нельзя удалить пользователя-администратора

#### 5.2. Управление папками
- **Предусловия:** Пользователь с правами администратора
- **Шаги тестирования:**
  1. Отправить команду `/admin`
  2. Выбрать "Список папок"
  3. Добавить новую папку
  4. Удалить существующую папку
- **Ожидаемый результат:**
  - Отображается актуальный список папок
  - Новая папка успешно добавляется
  - Папка успешно удаляется
- **Сценарии ошибок:**
  - Список папок не отображается
  - Ошибка при добавлении несуществующей папки
  - Папка не удаляется из списка

#### 5.3. Перезагрузка настроек
- **Предусловия:** Пользователь с правами администратора
- **Шаги тестирования:**
  1. Отправить команду `/admin`
  2. Выбрать "Перезагрузить списки"
- **Ожидаемый результат:**
  - Списки пользователей и папок перезагружаются
  - Отображается подтверждение с количеством загруженных элементов
- **Сценарии ошибок:**
  - Списки не перезагружаются
  - Ошибка доступа к файлам настроек
  - Некорректные данные после перезагрузки

### 6. Обработка ошибок и восстановление

#### 6.1. Отказоустойчивость соединения с Яндекс.Диском
- **Предусловия:** Настроен бот с подключением к Яндекс.Диску
- **Шаги тестирования:**
  1. Симулировать временную недоступность Яндекс.Диска
  2. Выполнить операции с файлами
  3. Восстановить соединение
- **Ожидаемый результат:**
  - Бот корректно обрабатывает ошибки соединения
  - После восстановления соединения операции возобновляются
- **Сценарии ошибок:**
  - Бот аварийно завершается при потере соединения
  - Операции не возобновляются после восстановления
  - Отсутствие информативных сообщений об ошибках

#### 6.2. Обработка параллельных сессий
- **Предусловия:** Несколько пользователей одновременно используют бота
- **Шаги тестирования:**
  1. Создать несколько сессий от разных пользователей
  2. Выполнять параллельные операции с файлами
- **Ожидаемый результат:**
  - Сессии пользователей корректно изолированы друг от друга
  - Параллельные операции выполняются без конфликтов
- **Сценарии ошибок:**
  - Смешивание данных между сессиями
  - Конфликты при параллельной загрузке файлов
  - Замедление работы при большом количестве пользователей

#### 6.3. Восстановление после перезапуска бота
- **Предусловия:** Есть активные сессии встреч
- **Шаги тестирования:**
  1. Перезапустить бота
  2. Проверить состояние активных сессий
- **Ожидаемый результат:**
  - Сессии не сохраняются после перезапуска (ожидаемое поведение)
  - Пользователь должен создать новую сессию
- **Сценарии ошибок:**
  - Некорректные сообщения об активных сессиях после перезапуска
  - Ошибки при создании новых сессий после перезапуска